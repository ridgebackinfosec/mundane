# Mundane Workflow Mappings
#
# Maps Nessus plugin IDs to verification workflow steps.
# These workflows are display-only and provide structured guidance
# for verifying specific vulnerabilities.
#
# Format:
#   plugin_id: Single ID ("57608") or comma-separated ("57608,10079,12345")
#   workflow_name: Human-readable name for the workflow
#   description: Brief description of what is being verified
#   steps: List of verification steps with commands and notes
#   references: List of reference URLs
# 
  # - plugin_id: ""
  #   workflow_name: ""
  #   description: ""
  #   steps:
  #     - title: ""
  #       commands:
  #         - ""
  #       notes: ""

  #   references:
  #     - ""

version: "1.0"

workflows:
  - plugin_id: "40984"
    workflow_name: "Investigat Browsable Web Directories"
    description: "Check for any filenames and content with confidential data."
    steps:
      - title: "Use wget to recursively download the contents of the browsable web directories and their subfolders"
        commands:
          - "wget -nc -r -l inf -i browsable.urls"
        
      - title: "Dig through the content with Trufflehog"
        commands:
          - "trufflehog filesystem --json \"browsable\" browsable | tee trufflehog.json"

    references:
      - "https://www.tenable.com/plugins/nessus/40984"
      - "https://www.blackhillsinfosec.com/rooting-for-secrets-with-trufflehog/"

  - plugin_id: "10759"
    workflow_name: "Web Server HTTP Header Internal IP Disclosure"
    description: "Occurs when a web server includes internal IP addresses in HTTP response headers, unintentionally exposing internal network details that can aid attackers in mapping or targeting internal infrastructure."
    steps:
      - title: "Try with NSE script"
        commands:
          - "sudo nmap --script http-internal-ip-disclosure --script-args http-internal-ip-disclosure.path=/ $IP -p $PORT"
        notes: ""

      - title: "Use Burp's Repeater"
        commands:
          - "Manually build and run a request using Burp's repeater"
        notes: "Manually exploit this via Burps Repeater functionality and forced the use of HTTP/1.0 without a Host header defined."

    references:
      - "https://www.tenable.com/plugins/nessus/10759"

  # SMB Signing Not Required (Plugin 57608)
  - plugin_id: "57608"
    workflow_name: "SMB Signing Not Required"
    description: "Remote SMB server does not enforce message signing"
    steps:
      - title: "Verify SMB signing is disabled"
        commands:
          - "netexec smb <target> -u <username> -p <password>"
          - "nmap -p445 --script smb-security-mode <target>"
        notes: "Check output for 'Message signing: disabled' or similar"

      - title: "Test NTLM relay attack feasibility"
        commands:
          - "responder -I <interface> -A"
          - "ntlmrelayx.py -tf targets.txt -smb2support"
        notes: "Attempt to relay captured NTLM authentication"

      - title: "Enumerate accessible shares"
        commands:
          - "netexec smb <target> -u <username> -p <password> --shares"
          - "smbclient -L //<target> -U <username>"
        notes: "List available SMB shares and permissions"

    references:
      - "https://www.tenable.com/plugins/nessus/57608"
      - "https://attack.mitre.org/techniques/T1557/001/"

  - plugin_id: "10114"
    workflow_name: "ICMP Timestamp Request Remote Date Disclosure"
    description: "Occurs when a system responds to ICMP timestamp requests with its local time, allowing remote attackers to infer the deviceâ€™s timezone, system clock, and potentially aiding in reconnaissance or timing attacks."
    steps:
      - title: "Check request and response types"
        commands:
          - "hping3 IP_address --icmp --icmp-ts -V"
        notes: "You're looking to see if the ICMP timestamp request was coded as message type 13 and the subsequent timestamp response was coded as message type 14"

      - title: "Now convert an hping3's IMCP timestamp response into human readable time using https://github.com/DefensiveOrigins/icmp-timestamp."
        commands:
          - "bash icmp-timestamp.sh -O <Originate timestamp> -R <Recieve timestamp> -T <Transmit timestamp>"
    references:
      - "https://www.tenable.com/plugins/nessus/10114"
      - "https://github.com/DefensiveOrigins/icmp-timestamp"

  - plugin_id: "41028"
    workflow_name: "SNMP Default Community Strings"
    description: "Default SNMP community string usage could allow for configuration read through SNMP queries and possibly a full SNMP MIB tree walk."
    steps:
      - title: "Enumerate SNMP info against the internal scope"
        commands:
          - "sudo nmap -sU -sV -p161 -T4 --script \"snmp* and not snmp-brute\" IP_address"
      
      - title: "Specifically use snmp-brute to verify this issue and to check for additional commonly used SNMP community strings"
        commands:
          - "sudo nmap -sU -sV -p161 -T4 --script snmp-brute IP_address"

      - title: "Also available to use..."
        commands:
          - "msfconsole -q -x 'use auxiliary/scanner/snmp/snmp_login'"
          - "https://github.com/trailofbits/onesixtyone"
          - "https://github.com/net-snmp/net-snmp"

    references:
      - "https://www.tenable.com/plugins/nessus/41028"
      - "https://www.blackhillsinfosec.com/snmp-strings-attached/"
      - "https://github.com/trailofbits/onesixtyone"
      - "https://github.com/net-snmp/net-snmp"

  - plugin_id: "20007,104743,157288"
    workflow_name: "Deprecated SSL/TLS Encryption"
    description: "Deprecated encryption protocol versions should be removed from support unless absolutely necessary."
    steps:
      - title: "Enumerate the supported encryption protocol versions and alogorithims."
        commands:
          - "sudo nmap -A --script=ssl-enum-ciphers,ssl-cert,ssl-date IP_address"
        notes: "SSLv2, SSLv3, and TLSv1.0 are all considered deprecated and should not be supported anymore. TLSv1.1 is also outdated but not of terrible concern."

    references:
      - "https://www.tenable.com/plugins/nessus/20007"
      - "https://www.tenable.com/plugins/nessus/104743"
      - "https://www.tenable.com/plugins/nessus/157288"
      - "https://www.blackhillsinfosec.com/testing-tls-and-certificates/"

  - plugin_id: "42263"
    workflow_name: "Unencrypted Telnet Server"
    description: "The primary risk posed by unencrypted network protocols is that an attacker can eavesdrop on communication and extract any information in it, such as confidential data and credentials."
    steps:
      - title: "Verify Telnet usage."
        commands:
          - "sudo nmap -A -p 23 IP_address"

      - title: "Intercept cleartext traffic for proof-of-concept."
        commands:
          - "tcpdump tcp port 23 and dst IP_address and src 0.0.0.0 -i eth0 -w telnet.pcap -tttt"
          - "telnet IP_address 23"
        notes: "Start up tcpdump to capture packets then trigger a telnet connect. Enter any credentials you want. We're just trying to prove the capturing."

      - title: "Wireshark Analysis"
        notes: "Open the pcap file in Wireshark and find where the cleartext creds were captured. Screenshot it and put it in your report."

    references:
      - "https://www.tenable.com/plugins/nessus/42263"

  - plugin_id: "187315"
    workflow_name: "Terrapin Weakness"
    description: "SSH vulnerability that could permit MITM style attacks"
    steps:
      - title: "Copy the POC Python script (https://github.com/ronf/asyncssh/security/advisories/GHSA-hfmc-7525-mj55)."

      - title: "In the POC script, replace the PROXY_IP variable with your systems IP on the network and replace the SERVER_IP variable with your target."

      - title: "Run the POC script & connect to the proxy server you started"
        commands:
          - "python terrapin-poc.py"
          - "ssh root@IP_address -p 2222"
        notes: "In the Python script output, a successful exploitation is evident when the two SSH output lines below are missing.\n\ndebug1: SSH2_MSG_EXT_INFO received\ndebug1: kex_input_ext_info: server-sig-algs=<rsa-sha2-256,rsa-sha2-512>"


    references:
      - "https://www.tenable.com/plugins/nessus/187315"
      - "https://github.com/ronf/asyncssh/security/advisories/GHSA-hfmc-7525-mj55"
      - "https://nvd.nist.gov/vuln/detail/CVE-2023-48795"
      - "https://terrapin-attack.com/"